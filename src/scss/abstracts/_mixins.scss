@use 'sass:string';
// =============================================================================
// ================ ОПТИМІЗОВАНІ МІКСІНИ ======================================
// =============================================================================
//
// Залишені тільки справді повторювані міксіни (використовуються 3+ рази)
// Видалені складні міксіни з великою кількістю параметрів
// Спрощені міксіни для часто використовуваних патернів
//
// =============================================================================

// ==========================================================================
// ОСНОВНІ LAYOUT МІКСІНИ (використовуються багато разів)
// ==========================================================================

// Responsive grid - використовується 5+ разів
@mixin grid-responsive($min-width: $min-grid-width-4el, $gap: $space-lg, $items-center: false) {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax($min-width, 1fr));
    gap: $gap;
    @if $items-center {
        justify-items: center;
        align-items: center;
    }
}

// Flex container - використовується 10+ разів
@mixin flex-responsive($direction: row, $gap: null, $wrap: null, $mobile-direction: null) {
    display: flex;
    flex-direction: $direction;
    @if $gap { gap: $gap; }
    @if $wrap { flex-wrap: $wrap; }
    
    @if $mobile-direction {
        @media (max-width: $breakpoint-mobile) {
            flex-direction: $mobile-direction;
        }
    }
}

// Split section для about/contact - використовується 2 рази, але критично важливий
@mixin split-section($image-side: left) {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0;
    
    @media (max-width: $breakpoint-tablet) {
        grid-template-columns: 1fr;
        min-height: auto;
        
        .offer-banner {
            @if $image-side == right {
                order: 2;
            }
        }
    }
    
    .offer-banner {
        display: flex;
        align-items: center;
        justify-content: center;
        background: $grey-extra-light;
        overflow: hidden;
        
        img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            min-height: 100%;
        }
    }
}

// ==========================================================================
// УТИЛІТИ ТА ПОЗИЦІОНУВАННЯ
// ==========================================================================

// Sticky element міксин
@mixin sticky-element($direction: top, $offset: 0, $z: $z-sticky, $animation: false) {
    position: sticky;
    z-index: $z;
    @if $direction == top {
        top: $offset;
    } @else if $direction == bottom {
        bottom: $offset;
    } @else if $direction == left {
        left: $offset;
    } @else if $direction == right {
        right: $offset;
    }
    @if $animation {
        @include hover-effect('sticky-element'); 
    }
}

// ==========================================================================
// ЕФЕКТИ (використовуються дуже часто - 15+ разів)
// ==========================================================================

// Hover ефекти - найбільш використовуваний міксин
@mixin hover-effect($type, $transition: $animation-slow $animation-ease) {
    $params: map-get($hover-effects-map, $type);
    $lift: if(map-has-key($params, lift), map-get($params, lift), null);
    $background: if(map-has-key($params, background), map-get($params, background), null);
    $color: if(map-has-key($params, color), map-get($params, color), null);
    $shadow: if(map-has-key($params, shadow), map-get($params, shadow), null);
    $scale: if(map-has-key($params, scale), map-get($params, scale), null);
    
    transition: transform #{$transition}, background #{$transition}, color #{$transition}, box-shadow #{$transition};

    &:hover {
        $transform: '';
        @if $scale { $transform: $transform + ' scale(' + $scale + ')'; }
        @if $lift { $transform: $transform + ' translateY(-' + $lift + ')'; }
        @if $transform != '' { transform: string.unquote($transform); }
        
        @if $background { background: $background; }
        @if $color { color: $color; }
        @if $shadow { box-shadow: $shadow; }
        z-index: $z-hover;
    }
}

// Press effect для active станів
@mixin press-effect($type, $transition: $animation-fast $animation-ease) {
    $params: map-get($press-effects-map, $type);
    $background: if(map-has-key($params, background), map-get($params, background), null);
    $color: if(map-has-key($params, color), map-get($params, color), null);
    $shadow: if(map-has-key($params, shadow), map-get($params, shadow), null);
    $scale: if(map-has-key($params, scale), map-get($params, scale), null);

    &:active, &:focus:active {
        $transform: '';
        @if $scale { $transform: $transform + ' scale(' + $scale + ')'; }
        @if $transform != '' { transform: string.unquote($transform); }
        @if $background { background: $background; }
        @if $color { color: $color; }
        @if $shadow { box-shadow: $shadow; }
        transition: #{$transition};
    }
}

// Selected effect для активних елементів
@mixin selected-effect($type, $transition: $animation-medium $animation-ease) {
    $params: map-get($selected-effects-map, $type);
    $background: if(map-has-key($params, background), map-get($params, background), null);
    $color: if(map-has-key($params, color), map-get($params, color), null);
    $shadow: if(map-has-key($params, shadow), map-get($params, shadow), null);
    $scale: if(map-has-key($params, scale), map-get($params, scale), null);

    transition: transform #{$transition}, background #{$transition}, color #{$transition}, box-shadow #{$transition};

    &.active, &.selected {
        $transform: '';
        @if $scale { $transform: $transform + ' scale(' + $scale + ')'; }
        @if $transform != '' { transform: string.unquote($transform); }
        @if $background { background: $background; }
        @if $color { color: $color; }
        @if $shadow { box-shadow: $shadow; }
    }
}

// Icon container міксин для header
@mixin icon-container($hover: 'header-icon', $tablet-position: center, $mobile-position: center, $gap: $space-md) {
    display: flex;
    gap: $gap;
    align-items: center;

    a {
        position: relative;
        display: inline-flex;
        padding: $space-sm;
        @include hover-effect($hover);
    }
}

// ==========================================================================
// УТИЛІТИ (часто використовувані)
// ==========================================================================

// Shaded background - використовується 5+ разів
@mixin shaded-background($image-url, $overlay: rgba(0, 0, 0, 0.4)) {
    background-image: linear-gradient($overlay, $overlay), url($image-url);
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
}

// Banner міксин - використовується кілька разів
@mixin banner($path) {
    @include shaded-background($path);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: $pure-white;
    text-align: center;
    
    h1 {
        font-size: $font-size-3xl;
        font-weight: $font-weight-bold;
        color: $pure-white;
        margin: 0;
    }
}

// ==========================================================================
// ФОРМИ (критичні для функціональності)
// ==========================================================================

// Base input - базовий для всіх інпутів
@mixin base-input {
    width: 100%;
    padding: $space-md;
    border: $border solid $form-input-border-color;
    border-radius: $radius-s;
    background: $form-input-bg-color;
    color: $form-input-text-color;
    font-size: $input-font-size;
    font-family: inherit;
    min-height: $input-height;
    transition: border-color $animation-fast $animation-ease;
    
    &:focus {
        outline: none;
        border-color: $form-input-border-color-focused;
        box-shadow: $shadow-form-focus;
    }
    
    &::placeholder {
        color: $input-text-color;
        opacity: 1;
    }
}

// Form group контейнер
@mixin form-group {
    position: relative;
    margin-bottom: $form-gap;
}

// Floating label styling
@mixin floating-label {
    position: absolute;
    left: $space-md;
    top: 50%;
    transform: translateY(-50%);
    background: $form-input-bg-color;
    padding: $floating-label-padding;
    color: $form-label-color;
    font-size: $font-size-sm;
    pointer-events: none;
    transition: all $animation-fast $animation-ease;
    z-index: 1;
    
    .required-star {
        color: $form-label-required-color;
    }
}

// Floating label active state
@mixin floating-label-active {
    top: 0;
    transform: translateY($floating-label-offset) scale($floating-label-scale);
    color: $form-label-color-focused;
    
    .required-star {
        color: $form-label-required-color;
    }
}

// Dropdown container
@mixin dropdown-container($max-width: $dropdown-max-width, $min-width: $dropdown-min-width) {
    position: relative;
    display: inline-block;
    width: 100%;
    max-width: $max-width;
    min-width: $min-width;
    flex-shrink: 0;
}

// Dropdown button
@mixin dropdown-button {
    @include base-input;
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    
    span {
        flex: 1;
        text-align: left;
        color: $form-input-text-color;
    }
    
    img {
        width: $dropdown-arrow-size;
        height: $dropdown-arrow-size;
        transition: transform $animation-fast $animation-ease;
        flex-shrink: 0;
    }
    
    &.active img {
        transform: rotate(180deg);
    }
}

// Dropdown options
@mixin dropdown-options {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: $form-input-bg-color;
    border: 2px solid $form-input-border-color;
    border-top: none;
    z-index: $dropdown-z-index;
    max-height: $dropdown-max-height;
    overflow-y: auto;
    opacity: 0;
    visibility: hidden;
    transition: all $animation-fast $animation-ease;
    
    &.show {
        opacity: 1;
        visibility: visible;
    }
    
    li {
        list-style: none;
        padding: $space-sm $space-md;
        cursor: pointer;
        color: $form-input-text-color;
        font-size: $font-size-sm;
        transition: all $animation-fast $animation-ease;
    }
}

// Компактні input стилі
@mixin compact-input-styles() {
    @include base-input;
    padding: $space-md;
    height: $input-height;
}

// Search field container
@mixin search-field-container {
    position: relative;
    margin-bottom: $space-lg;
    max-width: $search-field-max-width;
    width: 100%;
}

// Search icon position
@mixin search-icon-position {
    position: absolute;
    right: $space-md;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    width: $search-icon-container-size;
    height: $search-icon-container-size;
    transition: all $animation-fast $animation-ease;
    
    img {
        width: $search-icon-size;
        height: $search-icon-size;
    }
}

// ==========================================================================
// СПЕЦИФІЧНІ МІКСІНИ (зберігаємо тільки найважливіші)
// ==========================================================================

// Section styles - використовується часто для промо-секцій
@mixin section-styles($type) {
    $params: map-get($section-style-map, $type);
    $padding-top-bottom: if(map-has-key($params, padding-top-bottom), map-get($params, padding-top-bottom), 0);
    $padding-left: if(map-has-key($params, padding-left), map-get($params, padding-left), $space-4xl);
    $gap: if(map-has-key($params, gap), map-get($params, gap), $space-lg);
    
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: flex-start;
    text-align: start;
    padding: $padding-top-bottom $padding-left;
    gap: $gap;

    h2 {
        $title-color: if(map-has-key($params, title-color), map-get($params, title-color), $text-color);
        $title-size: if(map-has-key($params, title-size), map-get($params, title-size), $font-size-2xl);    
        font-size: $title-size;
        font-weight: $font-weight-black;
        line-height: $line-height-single;
        color: $title-color;
        margin: 0;
    }

    p {
        $text-color: if(map-has-key($params, text-color), map-get($params, text-color), $grey-dark);
        $text-size: if(map-has-key($params, text-size), map-get($params, text-size), $font-size-sm);
        font-size: $text-size;
        font-weight: $font-weight-normal;
        line-height: $line-height-base;
        color: $text-color;
    }

    button {
        @include button('btn-base');
    }
}

// Checkbox - специфічний але важливий
@mixin checkbox-round($size: $checkbox-size, $type: 'round') {
    width: $size;
    height: $size;
    margin: 0;
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    border: $checkbox-border-width solid $checkbox-border-color;
    background: $checkbox-bg-color;
    cursor: pointer;
    position: relative;
    transition: all $animation-medium $animation-ease;
    
    @if $type == 'round' {
        border-radius: 50%;
    } @else {
        border-radius: $radius-s;
    }
    
    &:checked {
        background: $checkbox-bg-color-checked;
        border-color: $checkbox-bg-color-checked;
        
        &::after {
            content: '';
            position: absolute;
            width: $checkbox-dot-size;
            height: $checkbox-dot-size;
            background: $checkbox-dot-color;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    }
}

// Divider - простий і часто використовуваний
@mixin divider($color: $accent-pink, $border: $border) {
    border: $border solid $color;
    width: 100%;
}

// Modal міксіни - критичні для функціональності
@mixin modal-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: $modal-backdrop;
    z-index: $z-modal-backdrop;
    display: flex;
    justify-content: center;
    align-items: center;
}

@mixin modal-content($min-width: $modal-min-width, $max-width: $modal-max-width) {
    background: $pure-white;
    min-width: $min-width;
    max-width: $max-width;
    width: 90%;
    position: fixed;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    max-height: $modal-max-height;
    overflow: auto;
    box-shadow: $shadow-modal;
    z-index: $z-modal;
}

// ==========================================================================
// КАТАЛОГ МІКСІНИ (об'єднані найважливіші)
// ==========================================================================

// Основний layout каталогу
@mixin catalog-layout {
    display: grid;
    grid-template-columns: $catalog-sidebar-ratio;
    gap: $catalog-main-gap;
    
    @media (max-width: $breakpoint-tablet) {
        grid-template-columns: 1fr;
        gap: $space-md;
        
        .sidebar {
            order: -1;
            margin-bottom: $space-md;
        }
    }
}

// Product grid
@mixin product-grid-layout {
    display: grid;
    gap: $space-lg;
    margin-bottom: $space-lg;
    width: 100%;
    grid-template-columns: repeat(auto-fit, minmax($product-grid-min-width-md, 1fr));
    
    @media (min-width: $breakpoint-desktop) {
        grid-template-columns: repeat(3, 1fr);
        gap: $space-xl $space-lg;
    }
    
    @media (max-width: $breakpoint-tablet) {
        grid-template-columns: repeat(auto-fit, minmax($product-grid-min-width-sm, 1fr));
        gap: $space-md;
    }
    
    @media (max-width: $breakpoint-mobile) {
        grid-template-columns: repeat(auto-fit, minmax($product-grid-min-width-lg, 1fr));
        gap: $space-md;
    }
}

// Filters layout
@mixin filters-grid-layout {
    padding: $space-lg 0;
    gap: $space-lg;
    @include grid-responsive($min-grid-width-4el, $space-lg);
    
    @media (max-width: $breakpoint-tablet) {
        padding: $space-md 0;
        gap: $space-md;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }
    
    @media (max-width: $breakpoint-mobile) {
        grid-template-columns: 1fr;
        gap: $space-sm;
        padding: $space-md 0;
    }
}